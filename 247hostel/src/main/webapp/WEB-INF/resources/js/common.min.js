
function checkStatus() {
    if (productId == 0) return !1;
    if (userId == "") {
        var n = $.cookie("savedProductIds");
        n != null && n.search(productId) > -1 && changeHtml()
    } else $.ajax({
        type: "POST",
        cache: !1,
        url: "/post/getProduct",
        data: {
            productId: productId
        },
        success: function (n) {
            n > 0 && changeHtml()
        }
    })
}

function checkCookie() {
    var n = $.cookie("savedProductIds");
    n == null ? $("#boxProductSaved").hide() : hideBox()
}

function changeHtml() {
    $("#saveNews").removeAttr("onclick").html('<i class="fa fa-heart-o"></i> Đã lưu');
}

function GetProductlist() {
    var listProductId = $.cookie("savedProductIds"),
        html = "";
    if (listProductId != null) {
        $.ajax({
            type: "POST",
            cache: !1,
            url: "/post/getProductList",
            data: {
                productIds: listProductId
            },
            success: function (data) {
                if (data != "") {
                    $.each(data, function (n, t) {
                        html += '<li pid="' + t.MaTin + '"><a href="/phong-tro/' + t.MaTin + '/' + t.Url + '.html">' + t.TieuDe + '<\/a><span title="Xóa" onclick="deleteProduct(this,' + t.MaTin + ');"><\/span><\/li>'
                    });
                    $("#boxProductSaved ul").html(html);
                    $("#boxProductSaved").show();
                }
            },
            error: function() {}
        });
    }
}

function deleteProduct(n, t) {
    if (confirm("Bạn có chắc chắn muốn xóa ?")) {
        $(n).parent().remove();
        var i = $.cookie("savedProductIds") != null ? $.cookie("savedProductIds") : "";
        i = i.replace(t, "").replace(",,", ",");
        //deleteProductSaved(t);
        i != "" && i != "," ? $.cookie("savedProductIds", i, {
            domain: domainCookie,
            path: "/",
            expires: 7
        }) : $.removeCookie("savedProductIds", {
            domain: domainCookie,
            path: "/"
        });
        $("#boxProductSaved ul li").length == 0 && $("#boxProductSaved").hide()
    }
}

function deleteAllNews() {
    if (confirm("Bạn có chắc chắn muốn xóa tất cả ?")) {
        var n = $.cookie("savedProductIds");
        (n == null || n == "") && (n = "", $("#boxProductSaved li").each(function () {
            n += $(this).attr("pid") + ","
        }));
        //deleteListProductSaved(n);
        $.removeCookie("savedProductIds", {
            domain: domainCookie,
            path: "/"
        });
        $("#boxProductSaved").hide()
    }
}

function openBox() {
    $("#boxProductSaved ul").show();
    var n = $("#boxProductSaved").css("bottom");
    n.replace("px", "") < -1 && $("#boxProductSaved").animate({
        bottom: "0"
    }, 200, function () {
        $("#boxProductSaved #btn_close").removeClass().addClass("hideAll")
    })
}

function hideBox() {
    $.cookie("statusBox") == 0 && ($("#boxProductSaved ul").hide(), $("#boxProductSaved").css("bottom", "-10px"), $("#boxProductSaved #btn_close").removeClass().addClass("showAll"))
}

function productSaved(n, t) {
    var i = $.cookie("savedProductIds");
    i != null ? i.search(t) == -1 && $.cookie("savedProductIds", t + "," + i, {
        domain: domainCookie,
        path: "/",
        expires: 7
    }) : $.cookie("savedProductIds", t, {
        domain: domainCookie,
        path: "/",
        expires: 7
    });
    $("#boxProductSaved").show();
    GetProductlist();
    $("li#" + t).removeClass("hover");
    $(".boxSave" + t).addClass("dplblock");
    $("#saveProduct" + t).hide();
    $("#hideProduct" + t).hide();
    $("#savedProduct" + t).show();
    $(n).removeAttr("onclick").html('<i class="fa fa-heart-o"></i> Đã lưu');
    openBox()
}

function checkStatusListId() {
    var n, listId;
    userId == "" ? (n = $.cookie("savedProductIds"), n != null && $(".productlist .item .save").each(function () {
        var t = $(this).attr("id");
        n.search(t) > -1 && $("#" + t).text("Đã lưu").removeClass().addClass("saved").removeAttr("onclick")
    })) : (listId = "", $(".productlist .item .save").each(function () {
        listId += $(this).attr("id") + ","
    }), listId != "" && $.ajax({
        type: "POST",
        cache: !1,
        url: "/post/getListProductId",
        data: {
            productIds: listId
        },
        success: function (data) {
            listId = "";
            data != null && (likeReturn = eval("(" + data + ")"), $.each(likeReturn, function (n, t) {
                listId += t.ProductId + ","
            }), $(".productlist .item .save").each(function () {
                var n = $(this).attr("id");
                listId.search(n) > -1 && $("#" + n).text("Đã lưu").removeClass().addClass("saved").removeAttr("onclick")
            }))
        }
    }))
}
$(document).ready(function () {
    var c, l, u, f;
    GetProductlist();
    checkStatus();
    checkCookie();
    $("#btn_close").click(function () {
        var n = $("#boxProductSaved ul").height() + 15,
            t = $("#boxProductSaved").css("bottom");
        t == -n + "px" || t == "-10px" ? ($("#boxProductSaved ul").show(), $("#boxProductSaved #btn_close").removeClass().addClass("hideAll"), $("#boxProductSaved").animate({
            bottom: "0"
        }, 200, function () {
            $.cookie("statusBox", 1, {
                domain: domainCookie,
                path: "/",
                expires: 7
            })
        })) : $("#boxProductSaved").animate({
            bottom: -n
        }, 200, function () {
            $("#boxProductSaved #btn_close").removeClass().addClass("showAll");
            $.cookie("statusBox", 0, {
                domain: domainCookie,
                path: "/",
                expires: 7
            })
        })
    });
});